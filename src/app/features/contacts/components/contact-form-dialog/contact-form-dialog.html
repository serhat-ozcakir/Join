@if (supabase.showForm()) {
  <div class="modal-overlay" (click)="closeForm()">
    <div class="modal" (click)="$event.stopPropagation()" [class.closing]="isClosing()">
      <button class="close-btn" (click)="closeForm()">
        <img src="assets/icons/close-button.svg" alt="" />
      </button>
      <aside class="description-area">
        <img class="logo" src="assets/icons/logo.png" alt="Join Logo" />
        <h2 class="description-headline">
          {{ supabase.editMode() ? 'Edit Contact' : 'Add Contact' }}
        </h2>
        <p class="description-text">
          {{ supabase.editMode() ? '' : 'Tasks are better with a team!' }}
        </p>
        <div class="blue-line"></div>
      </aside>

      @if (supabase.editMode() && supabase.selectedContact()) {
        <div
          class="contact-icon avatar-circle mobile-avatar"
          [style.background]="getAvatarColor(supabase.selectedContact()!.name)"
        >
          {{ getInitials(supabase.selectedContact()!.name) }}
        </div>
      } @else {
        <img
          class="contact-icon mobile-avatar"
          src="assets/images/contact.png"
          alt="Contact Icon"
        />
      }

      <article class="form-area">
        <div class="inner-form">
          @if (supabase.editMode() && supabase.selectedContact()) {
            <div
              class="contact-icon avatar-circle desktop-avatar"
              [style.background]="getAvatarColor(supabase.selectedContact()!.name)"
            >
              {{ getInitials(supabase.selectedContact()!.name) }}
            </div>
          } @else {
            <img
              class="contact-icon desktop-avatar"
              src="assets/images/contact.png"
              alt="Contact Icon"
            />
          }
          <form class="form" [formGroup]="contactForm" (ngSubmit)="saveContact()" novalidate>
            <div class="form-group">
              <input
                type="text"
                placeholder="Name"
                formControlName="name"
                maxlength="30"
                [class.invalid]="nameControl.invalid && nameControl.touched"
              />
              <img class="form-icon" src="assets/icons/name.svg" alt="Person Icon" />
              @if (nameControl.invalid && nameControl.touched) {
                <span class="error">{{ getErrorMessage('name') }}</span>
              }
            </div>

            <div class="form-group">
              <input
                type="email"
                placeholder="Email"
                formControlName="email"
                maxlength="30"
                [class.invalid]="emailControl.invalid && emailControl.touched"
              />
              <img class="form-icon" src="assets/icons/mail.svg" alt="Person Icon" />
              @if (emailControl.invalid && emailControl.touched) {
                <span class="error">{{ getErrorMessage('email') }}</span>
              }
            </div>

            <div class="form-group">
              <input
                type="tel"
                placeholder="Phone"
                formControlName="phone"
                maxlength="15"
                (input)="updatePhone($any($event.target).value)"
                (keypress)="onPhoneKeyPress($event)"
                [class.invalid]="phoneControl.invalid && phoneControl.touched"
              />
              <img class="form-icon" src="assets/icons/phone.svg" alt="Person Icon" />
              @if (phoneControl.invalid && phoneControl.touched) {
                <span class="error">{{ getErrorMessage('phone') }}</span>
              }
            </div>

            <div class="form-actions">
              @if (!supabase.editMode()) {
                <button type="button" class="cancel-btn" (click)="closeForm()">
                  Cancel
                  <img class="icon-default" src="assets/icons/close-button.svg" />
                  <img class="icon-hover" src="assets/icons/close-button-hover.svg" />
                </button>
              }

              @if (supabase.editMode()) {
                <button type="button" class="delete-btn" (click)="deleteContact()">Delete</button>
              }
              <button type="submit" [disabled]="saving()" [class.form-invalid]="contactForm.invalid">
                {{ saving() ? 'Saving...' : supabase.editMode() ? 'Save' : 'Create contact' }}
                <img class="submit-icon" src="assets/icons/check.svg" alt="Close Button" />
              </button>
            </div>
          </form>
        </div>
      </article>
    </div>
  </div>
}
